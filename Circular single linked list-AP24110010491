#include <stdio.h>
#include <stdlib.h>

struct node {
    int data;
    struct node *next;
};

struct node *head = NULL;
struct node *tail = NULL;

struct node* createNode(int data);
void printList();
void createList();
int getLength();
int isEmpty();

void insert_at_beg(int);
void insert_at_end(int);
void insert_at_pos(int, int);

void delete_at_beg();
void delete_at_end();
void delete_at_pos(int);

int readData();
void search(int);

int main() {
    int data, choice, pos, ch;
    createList();

    do {
        printf("\n=== CIRCULAR LINKED LIST MANAGER ===\n");
        printf("1. Insert at beginning\n");
        printf("2. Insert at end\n");
        printf("3. Insert at position\n");
        printf("4. Delete from beginning\n");
        printf("5. Delete from end\n");
        printf("6. Delete from position\n");
        printf("7. Search element\n");
        printf("8. Display length\n");
        printf("0. Exit\n");
        
        printf("Enter your choice: ");
        scanf("%d", &choice);
        
        switch(choice) {
            case 1: data = readData();
                    insert_at_beg(data);
                    break;
            case 2: data = readData();
                    insert_at_end(data);
                    break;
            case 3: data = readData();
                    printf("Enter position to insert (1-based): ");
                    scanf("%d", &pos);
                    insert_at_pos(pos, data);
                    break;
            case 4: delete_at_beg();
                    break;
            case 5: delete_at_end();
                    break;
            case 6: printf("Enter position to delete (1-based): ");
                    scanf("%d", &pos);
                    delete_at_pos(pos);
                    break;
            case 7: data = readData();
                    search(data);
                    break;
            case 8: printf("List length: %d\n", getLength());
                    break;
            case 0: break;
            default: printf("Invalid choice!\n");
        }
        
        if (!isEmpty()) {
            printList();
        } else {
            printf("List is empty\n");
        }
        
        if (choice != 0) {
            printf("Continue? (0=No, 1=Yes): ");
            scanf("%d", &ch);
            if (ch == 0) break;
        }
    } while (choice != 0);
    return 0;
}

int readData() {
    int data;
    printf("Enter element: ");
    scanf("%d", &data);
    return data;
}

struct node* createNode(int data) {
    struct node* newnode = (struct node*)malloc(sizeof(struct node));
    if (newnode == NULL) {
        printf("Memory allocation failed!\n");
        exit(1);
    }
    newnode->data = data;
    newnode->next = NULL;
    return newnode;
}

int isEmpty() {
    return head == NULL;
}

int getLength() {
    if (isEmpty()) return 0;
    int len = 0;
    struct node* temp = head;
    do {
        len++;
        temp = temp->next;
    } while (temp != head);
    return len;
}

void createList() {
    int choice, data;
    printf("=== CREATE INITIAL LIST ===\n");
    do {
        data = readData();
        struct node* newnode = createNode(data);
        
        if (isEmpty()) {
            head = tail = newnode;
            tail->next = head;
        } else {
            tail->next = newnode;
            tail = newnode;
            tail->next = head;
        }
        
        printList();
        printf("Add more? (0=Yes, 1=No): ");
        scanf("%d", &choice);
    } while (choice != 1);
}

void insert_at_beg(int ele) {
    struct node* newnode = createNode(ele);
    if (isEmpty()) {
        head = tail = newnode;
        tail->next = head;
    } else {
        struct node* temp = head;
        do {
            temp = temp->next;
        } while (temp->next != head);
        newnode->next = head;
        head = newnode;
        temp->next = head;
    }
    printf("Inserted at beginning\n");
}

void insert_at_end(int ele) {
    struct node* newnode = createNode(ele);
    if (isEmpty()) {
        head = tail = newnode;
        tail->next = head;
    } else {
        struct node* temp = head;
        do {
            temp = temp->next;
        } while (temp->next != head);
        
        temp->next = newnode;
        newnode->next = head;
        tail = newnode;
    }
    printf("Inserted at end\n");
}

void insert_at_pos(int pos, int ele) {
    int len = getLength();
    if (pos < 1 || pos > len + 1) {
        printf("Invalid position! Must be 1 to %d\n", len + 1);
        return;
    }
    
    if (pos == 1) {
        insert_at_beg(ele);
        return;
    }
    
    if (pos == len + 1) {
        insert_at_end(ele);
        return;
    }
    
    struct node* newnode = createNode(ele);
    struct node* temp = head;
    int i = 1;
    
    while (i < pos - 1) {
        temp = temp->next;
        i++;
    }
    
    newnode->next = temp->next;
    temp->next = newnode;
    printf("Inserted at position %d\n", pos);
}

void delete_at_beg() {
    if (isEmpty()) {
        printf("List is empty!\n");
        return;
    }
    
    struct node* dnode = head;
    if (head == tail) {
        free(dnode);
        head = tail = NULL;
    } else {
        struct node* temp = head;
        do {
            temp = temp->next;
        } while (temp->next != head);
        
        head = head->next;
        temp->next = head;
        free(dnode);
    }
    printf("Deleted from beginning\n");
}

void delete_at_end() {
    if (isEmpty()) {
        printf("List is empty!\n");
        return;
    }
    
    if (head == tail) {
        free(head);
        head = tail = NULL;
    } else {
        struct node* temp = head;
        struct node* prev = NULL;
        
        do {
            prev = temp;
            temp = temp->next;
        } while (temp->next != head);
        
        prev->next = head;
        tail = prev;
        free(temp);
    }
    printf("Deleted from end\n");
}

void delete_at_pos(int pos) {
    int len = getLength();
    if (pos < 1 || pos > len) {
        printf("Invalid position! Must be 1 to %d\n", len);
        return;
    }
    
    if (pos == 1) {
        delete_at_beg();
        return;
    }
    
    if (pos == len) {
        delete_at_end();
        return;
    }
    
    struct node* temp = head;
    int i = 1;
    
    while (i < pos - 1) {
        temp = temp->next;
        i++;
    }
    
    struct node* dnode = temp->next;
    temp->next = dnode->next;
    free(dnode);
    printf("Deleted position %d\n", pos);
}

void search(int x) {
    if (isEmpty()) {
        printf("List is empty!\n");
        return;
    }
    
    struct node* temp = head;
    int pos = 1;
    do {
        if (temp->data == x) {
            printf("Element %d found at position %d\n", x, pos);
            return;
        }
        temp = temp->next;
        pos++;
    } while (temp != head);
    
    printf("Element %d not found\n", x);
}

void printList() {
    if (isEmpty()) {
        printf("List is empty\n");
        return;
    }
    
    printf("List: ");
    struct node* temp = head;
    do {
        printf("%d -> ", temp->data);
        temp = temp->next;
    } while (temp != head);
    printf("(back to head)\n");
}
